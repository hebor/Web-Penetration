## 算数运算

算数运算的四种方法

| 语法  | 说明                                                         | 示例          |
| ----- | ------------------------------------------------------------ | ------------- |
| $[]   | `[]`是test命令的缩写，使用此语法执行算数运算时会需要先经过命令的转换 | $[1+2]        |
| $(()) | 4种算数运算中计算效率最高的方式，无需经过命令转换，直接运算  | $((4-3))      |
| expr  | 系统命令，此命令本身存在诸多语法限制，不建议用此命令直接执行算术运算，但通过此命令可以实现结合算数运算做条件判断、数据类型转换等操作 | expr  6 \\* 5 |
| let   | 系统命令，可省略变量的$符，但无法直接输出计算结果，需要经过变量转输出 | let sum=8/7   |

```bash
#!/bin/bash
#数值运算
a=1314
b=520
echo $a+$b=$[$a+$b]
echo $a-$b=$(($a-$b))	
echo $a*$b=`expr $a \* $b`
let rt1=a/b rt2=a%b
echo $rt1
echo $rt2
```

## 判断语句

| 判断式       | 说明                                   |
| ------------ | -------------------------------------- |
| [ 表达式 ]   | 中括号与表达式左右两边必须用空格分隔   |
| [[ 表达式 ]] | 双中括号与表达式左右两边必须用空格分隔 |
| ((表达式))   | 无空格限制                             |

### 逻辑运算符

| 选项 | 操作符 | 说明                           |
| ---- | ------ | ------------------------------ |
| -a   | &&     | 与运算，条件都为真则判断为真   |
| -o   | \|\|   | 或运算，任一条件为真则判断为真 |
| !    | !      | 非运算，判断结果取反           |

### 比较运算符

Number型比较运算符

| 选项 | 操作符 | 说明     |
| ---- | ------ | -------- |
| -gt  | >      | 大于号   |
| -ge  | >=     | 大于等于 |
| -lt  | <      | 小于号   |
| -le  | <=     | 小于等于 |
| -eq  | ==     | 等于     |
| -ne  | !=     | 不等于   |

string型比较运算符

|      | 操作符 | 说明                                                |
| ---- | ------ | --------------------------------------------------- |
|      | <、>   | 判断字符相同顺位的字符大小                          |
|      | =      | 判断字符串是否相等                                  |
|      | !=     | 判断字符串是否不相等                                |
|      | =~     | 匹配                                                |
|      | !=~    | 不匹配                                              |
| -z   |        | 判断字符串长度是否为0，也可以用于判断变量是否为空   |
| -n   |        | 判断字符串长度是否非0，也可以用于判断变量是否不为空 |

### 文件判断

| 选项 | 说明                             | 示例               |
| ---- | -------------------------------- | ------------------ |
| -f   | 判断指定文件是否存在且为普通文件 | [ -f /file ]       |
| -d   | 判断指定目录是否存在             | [ -d /dir ]        |
| -e   | 判断指定文件或目录是否存在       | [ -e /file\|/dir ] |
| -r   | 判断指定文件或目录是否可读       | [ -r /file\|/dir ] |
| -w   | 判断指定文件或目录是否可写       | [ -w /file\|/dir ]   |

## 变量

| 变量名  | 变量类型   | 说明                                                         | 示例                                   |
| ------- | ---------- | ------------------------------------------------------------ | -------------------------------------- |
| $RANDOM | 环境变量   | 随机数，RONDOM范围是0-32767                                  | echo $RANDOM                           |
| $USER   | 环境变量   | 账户名                                                       | echo $USER                             |
| $1      | 位置变量   | 第一个参数                                                   | ./test.sh one two，$1的值就是one       |
| $2      | 位置变量   | 第二个参数                                                   | ./test.sh one two，$2的值就是two       |
| ${10}   | 位置变量   | 第十个参数                                                   | 一位数以上的位置变量需要用花括号括起来 |
| $#      | 预定义变量 | 命令行中位置参数的个数                                       |                                        |
| $*      | 预定义变量 | 所有位置参数的内容，将所有参数作为一个字符串一次性传递       |                                        |
| $@      | 预定义变量 | 所有位置参数的内容，将所有参数逐个传递                       |                                        |
| $?      | 预定义变量 | 上一条命令执行后返回的状态，当返回状态值为0时表示执行正常，非0表示执行异常或出错 |                                        |
| $$      | 预定义变量 | 当前所在进程的进程号                                         |                                        |
| $!      | 预定义变量 | 后台运行的最后一个进程号                                     |                                        |
| $0      | 预定义变量 | 当前执行的进程/程序名                                        |                                        |

```bash
[root@node1 shell]# vim var.sh
#!/bin/bash
#var.sh
echo '$1='$1
echo '$2='$2
echo '$10='$10
echo '$10='${10}
echo '$$='$$
echo '$#='$#
echo '$@='$@
echo '$*='$*
echo '$?='$?
[root@node1 shell]# sh var.sh a b c d e f g h j k l m n
```







批量新建用户

```bash
#!/bin/bash
#useradd.sh
userinfo=/root/shell/userinfo
[ -f $userinfo ] || echo "not find userinfo file"
cat $userinfo | xargs -I {} useradd {}
```

xargs命令的主要功能是从标准输入读取数据，并将这些数据作为参数传递给其他命令，其默认行文是将输入内容作为参数追加到其他命令的末尾，从这一点来说`cat $userinfo | xargs useradd`与`cat $userinfo | xargs -I {} useradd {}`可以实现同样的效果，但useradd命令的语法要求用户名必须作为第一个独立参数，而xargs命令的默认会将多个参数合并为单次调用，它不符合useradd命令的语法要求，因此需要使用`-I`选项来为useradd命令传参



打印字符数量大于5的单词

```bash
#!/bin/bash
#for3.sh
word="I am zkrc . I am an excellent man ."
for str in $word;
do
	[ ${#str} -gt 5 ] && echo $str
done
```



新建账户并设置密码

```bash
#!/bin/bash
#for4.sh
userinfo=/root/shell/user.info
[ ! -f $userinfo ] && echo "not find user info file" && exit
for user in $(cat $userinfo)
do
	id $user &> /dev/null
	if [ $? -eq 0 ];
	then
		echo "用户已存在"
		continue
	else
		random_str=$(date +"%F %T" | md5sum)
		passwd=$(echo ${random_str:2:8})
		useradd $user &> /dev/null
		echo "$user:$passwd" >> /root/shell/passwd.info
		cat /root/shell/passwd.info | chpasswd
		sleep 1
	fi
done
```



根据特征信息封堵IP

```bash
#!/bin/bash
#while3.sh
log_file=./netstat.info
[ ! -f $log_file ] && echo "登录日志文件不存在" && exit
grep "tcp" ./netstat.info | awk -F "[: ]+" '{print $6}' | sort | uniq -c | sort -rn -k1 > ./net_link.info

while read line;
do
	column1=$(echo $line | awk '{print $1}')
	column2=$(echo $line | awk '{print $2}')
	if [ $column1 -gt 5 -a $(iptables -t filter -nvL| grep $column2 | wc -l) -eq 0 ];
	then
		echo "iptables -t filter -I INPUT -s $column2 -j DROP"
	fi
done < ./net_link.info
```



调用CentOS函数

```bash
#!/bin/bash
#function1.sh
source /etc/init.d/functions    # 从其他脚本文件中加载函数
read -p "请输入一个数字: " num
if [ $num -eq 10 ];
then
	action "输入信息正确" /bin/true
else
	action "输入信息有误" /bin/false
fi
```



函数

```bash
#!/bin/bash
#compare5.sh
# 1.判断参数数量
function quantity() {
	if [ $# -ne 2 ];
	then
		echo "脚本参数数量有误"
		echo "example syntax: ./compare5.sh OPTION1 OPTION2"
		exit
	fi
}
# 2.判断参数是否为整数型
function type() {
	expr $1 + 1 &> /dev/null
	if [ $? -ne 0 ];
	then
		echo "$1参数类型有误，请输入整数型数据"
		exit
	fi
	expr $2 + 1 &> /dev/null
	if [ $? -ne 0 ];
	then
		echo "$2参数类型有误，请输入整数型数据"
		exit
	fi
}
# 3.比较参数大小
function compare() {
	if [ $1 -gt $2 ];
	then
		echo "$1 > $2"
	elif [ $1 -lt $2 ];
	then
		echo "$1 < $2"
	else
		echo "$1 = $2"
	fi
}
# 4.定义主函数
function main() {
	quantity $*
	type $*
	compare $*
}
# 5.调用主函数
main $*
```



数组示例1

```bash
#!/bin/bash
#array2.sh
array=(sdfd dfdsasdf dfsdfadf dsfadsf jkll)
for i in ${array[*]};
do
	if [ ${#i} -gt 4 ];
	then
		echo $i
	fi
done
```



猜拳游戏

```bash
#!/bin/bash
#array4.sh
#1.通用的选项
function choose() {
array=(石头 剪刀 布)
cat << end
Menu:
1. 石头
2. 剪刀
3. 布
end


read -p "做出你的选择: " user_see
user_use=$((user_see-1))

com_use=$[RANDOM%3]
com_see=$((com_use+1))
}
#2.判断用户选项是否合规
function user_type() {
        expr $user_see + 1 &> /dev/null
        if [ $? -ne 0 ];
        then
                echo "输入不合规，请输入整数选项"
                main
        elif [ $user_see -lt 1 -o $user_see -gt 3 ];
        then
                echo "输入选项超出范围，请确认选择"
                main
        else
                echo "你的选择是：${array[user_use]}"
        fi
}
# 3.比对结果
function compare() {
        case $user_see in
        1)
                if [ $com_use -eq 1 ];
                then
                        echo "计算机的选择是：${array[$com_use]}"
                        echo "你赢了"
                elif [ $com_use -eq 2 ];
                then
                        echo "计算机的选择是：${array[$com_use]}"
                        echo "你输了"
                else
                        echo "平局"
                fi
                ;;
        2)
                if [ $com_use -eq 2 ];
                then
                        echo "计算机的选择是：${array[$com_use]}"
                        echo "你赢了"
                elif [ $com_use -eq 0 ];
                then
                        echo "计算机的选择是：${array[$com_use]}"
                        echo "你输了"
                else
                        echo "平局"
                fi
                ;;
        3)
                if [ $com_use -eq 0 ];
                then
                        echo "计算机的选择是：${array[$com_use]}"
                        echo "你赢了"
                elif [ $com_use -eq 1 ];
                then
                        echo "计算机的选择是：${array[$com_use]}"
                        echo "你输了"
                else
                        echo "平局"
                fi
                ;;
        esac
}
function again() {
        read -p "要再来一局吗？ [y/n]" answer
        if [ "$answer" = "Y" -o "$answer" = "y" ];
        then
                main
        else
                exit
        fi
}
function main() {
        choose
        user_type
        compare
        again
}
main
```

